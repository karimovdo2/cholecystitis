# app.py
# Streamlit-опросник: 17 предикторов  → «заглушка»-прогноз холецистита
# запустить:  streamlit run app.py
import streamlit as st
import numpy as np
import random

st.set_page_config(
    page_title="Предсказание холецистита",
    page_icon="🩺",
    layout="centered",
)

# ─────────────────────────────  стили  ──────────────────────────────
st.markdown(
    """
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
      html, body, [class*="css"]  { font-family: 'Inter', sans-serif; }
      .block-container              { padding-top: 2rem; }
      .stButton>button               { width: 100%; border-radius: 8px;
                                       background: linear-gradient(90deg,#6366f1,#7c3aed);
                                       color:#fff; font-weight:600; height:3rem;}
      .stButton>button:hover         { background:#6366f1; }
      .title-h1                      { text-align:center; font-size:2rem;
                                       font-weight:700; margin-bottom:1.5rem; }
      .subtitle                      { font-size:1.25rem; font-weight:600;
                                       margin-top:1.5rem; margin-bottom:0.5rem; }
    </style>
    """,
    unsafe_allow_html=True,
)

st.markdown('<div class="title-h1">🩺 Опросник риска холецистита</div>', unsafe_allow_html=True)

# ─────────────────────────────  предикторы  ─────────────────────────
FEATURES = [
    'Степень фиброза по эластометрии',
    '1 блок - психическая и социальная адаптация не нарушается',
    'экстернальный тип пищевого поведения',
    'Частота приема пищи 1-2 раза -1, 3 раза -2, 4 и более раз -3',
    'St-index - индекс стеатоза ( возраст, рост, окружность талии, СД)',
    'Степень стеатоза по эластометрии',
    'Разнообразное питание да-1, нет-0',
    'Наследственность отягощена у близких родственников по ХНХ-1, ЖКБ-2, цирроз печени-3, хр.гепатит-4',
    'ОДА23+ ',
    '2 блок - интрапсихическая нарпавленностьреагирования на болезнь',
    'ИМТ',
    'Общий холестерин',
    'Перерывы между приемами пищи 2-4 часа -1, 6 и более часов-2, в разные дни значительно отличаются -3',
    'FLI - индекс стеатоза печени (рост, вес, окроужность талии, ГГТП, ТГ)',
    'ТГ',
    'Е-сигареты',
    'HSI - индекс стеатоза печени ( пол, ИМТ, АЛТ, АСТ, СД)'
]

# Категорические признаки (да/нет или фиксированные коды)
CATEGORICAL = {
    '1 блок - психическая и социальная адаптация не нарушается': ["0 – нарушается", "1 – не нарушается"],
    'экстернальный тип пищевого поведения': ["0 – нет", "1 – есть"],
    'Частота приема пищи 1-2 раза -1, 3 раза -2, 4 и более раз -3': ["-1", "-2", "-3"],
    'Разнообразное питание да-1, нет-0': ["0 – нет", "1 – да"],
    'Наследственность отягощена у близких родственников по ХНХ-1, ЖКБ-2, цирроз печени-3, хр.гепатит-4':
        ["0 – нет", "1 – ХНХ", "2 – ЖКБ", "3 – цирроз", "4 – хр.гепатит"],
    'ОДА23+ ': ["0 – нет", "1 – да"],
    '2 блок - интрапсихическая нарпавленностьреагирования на болезнь': ["0", "1"],
    'Е-сигареты': ["0 – нет", "1 – да"],
    'Перерывы между приемами пищи 2-4 часа -1, 6 и более часов-2, в разные дни значительно отличаются -3': ["-1", "-2", "-3"]
}

# ─────────────────────────────  форма  ──────────────────────────────
with st.form("predict_form"):
    for feat in FEATURES:
        st.markdown(f'<div class="subtitle">{feat}</div>', unsafe_allow_html=True)
        if feat in CATEGORICAL:
            val = st.selectbox("", CATEGORICAL[feat], key=feat)
        else:
            val = st.number_input("", value=0.0, format="%.2f", key=feat)
        st.session_state[feat] = val
    submitted = st.form_submit_button("Рассчитать")

# ────────────────────────────  «заглушка» прогноз  ──────────────────
if submitted:
    st.markdown("---")
    prob = round(random.uniform(0.05, 0.95), 3)   # псевдо-вероятность
    cls  = "✅ Холецестит ОЖИДАЕТСЯ" if prob >= 0.5 else "🟢 Холецестит НЕ прогнозируется"
    st.markdown(f"### Вероятность холецистита: **{prob}**")
    st.success(cls)
